
@{
    ViewData["Title"] = "IndexPaquetesPredeterminados";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<br>
<br>
@try
{
<div id="frmPaquetesPrdeterminadosReports" class="container ui segment">
    <div class="ui floating dropdown labeled search icon button" id="cbbCities">
        <i class="filter icon"></i>
        <span class="text">Filtrar por ciudad</span>
        <div class="menu">
            <div class="header">
                <i class="tags icon"></i> Filter by tag
            </div>
            <div class="item" data-value="0">Todos</div>

            @foreach (CityListViewModel item in ViewBag.Ciudades)
            {
                <div class="item" data-value="@item.ID">@item.Ciudad</div>
            }
        </div>
    </div>

    <div class="ui floating dropdown labeled search icon button" id="cbbPaquetes">
        <i class="filter icon"></i>
        <span class="text">Filtrar por paquetes</span>
        <div class="menu">
            <div class="header">
                <i class="tags icon"></i> Filter by tag
            </div>
            <div class="item" data-value="0">Todos</div>

            @foreach (DefaultPackagesListViewModel item in ViewBag.Paquetes)
            {
                <div class="item" data-value="@item.Id">@item.Nombre</div>
            }
        </div>
    </div>

    <div class="ui floating dropdown labeled search icon button" id="cbbHotels">
        <i class="filter icon"></i>
        <span class="text">Filtrar por hotel</span>
        <div class="menu">
            <div class="header">
                <i class="tags icon"></i> Filter by tag
            </div>
            <div class="item" data-value="0">Todos</div>

            @foreach (HotelListViewModel item in ViewBag.Hoteles)
            {
                <div class="item" data-value="@item.ID">@item.Hotel</div>
            }
        </div>
    </div>

    <div class="ui floating dropdown labeled search icon button" id="cbbrestaurant">
        <i class="filter icon"></i>
        <span class="text">Filtrar por restaurante</span>
        <div class="menu">
            <div class="header">
                <i class="tags icon"></i> Filter by tag
            </div>
            <div class="item" data-value="0">Todos</div>

            @foreach (RestaurantListViewModel item in ViewBag.Restaurantes)
            {
                <div class="item" data-value="@item.ID">@item.Restaurante</div>
            }
        </div>
    </div>


    <button class="ui positive button" onclick="REPORTS_FUNCTIONS.getReport_paquetes(true)">FILTRAR REPORTE</button>
    <button class="ui positive button" onclick="REPORTS_FUNCTIONS.getReport_paquetes(false)">TRAER TODOS</button>
    <a href="@Url.Action("DefaultPackagesReportXLS", "Report", new ReportCreationModel{DataSourceIndex= 2, HTMLFile = "DefaultPackagesReportXLS"} )" class="ui button icon">Excel <i class="file excel icon"></i> </a>

    <div class="ui segment">
        <iframe id="ifrReport" src="" frameborder="0" width="100%" height="680px"></iframe>
    </div>
</div>
}
catch (Exception)
{
    <script>location.assign("@Url.Action("Error", "Home")");</script>
}
@section Scripts{

    <script>
        $(".ui.dropdown").dropdown();
    </script>

    <script>
        const REPORTS_FUNCTIONS = {
            getReport_paquetes: function (parameter = false) {
                var query = {
                    parameters: {},
                    user_name: Client_User_Name
                };
                if (parameter) {
                    if ($("#cbbCities .item.selected").length > 0 && $("#cbbCities .item.selected").attr("data-value") != 0) {
                        var id_ciudad = $("#cbbCities .item.selected").attr("data-value");
                        query.parameters.ciudad_ID = parseInt(id_ciudad);
                    }
                    else {

                        delete query.parameters["ciudad_ID"];
                    }
                    if ($("#cbbPaquetes .item.selected").length > 0 && $("#cbbPaquetes .item.selected").attr("data-value") != 0) {
                        var id_paquetes = $("#cbbPaquetes .item.selected").attr("data-value");
                        query.parameters.id = parseInt(id_paquetes);
                    }
                    else {

                        delete query.parameters["id"];
                    }
                    if ($("#cbbHotels .item.selected").length > 0 && $("#cbbHotels .item.selected").attr("data-value") != 0) {
                        var id_hotel = $("#cbbHotels .item.selected").attr("data-value");
                        query.parameters.iD_Hotel = parseInt(id_hotel);
                    }
                    else {

                        delete query.parameters["iD_Hotel"];
                    }
                    if ($("#cbbrestaurant .item.selected").length > 0 && $("#cbbrestaurant .item.selected").attr("data-value") != 0) {
                        var id_restaurante = $("#cbbrestaurant .item.selected").attr("data-value");
                        query.parameters.iD_Restaurante = parseInt(id_restaurante);
                    }
                    else {

                        delete query.parameters["iD_Restaurante"];
                    }
                }
                $('#frmPaquetesPrdeterminadosReports #ifrReport').attr('src', `https://totaltravelfileservices.yourgreatbusinesscenter.com/PDFs/Paquetes_predeterminados_report_pdf.php?query=${JSON.stringify(query)}`);
            },
        }
        REPORTS_FUNCTIONS.getReport_paquetes(false);
    </script>
}