
@{
    ViewData["Title"] = "IndexUsuariosReport";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<br>
<br>
@try
{
    <div id="frmUsersReports" class="container ui segment">
        <div class="ui floating dropdown labeled search icon button" id="cbbRol">
            <i class="filter icon"></i>
            <span class="text">Filtrar por rol</span>
            <div class="menu">
                <div class="header">
                    <i class="tags icon"></i> Filter by tag
                </div>
                <div class="item" data-value="0">Todos</div>

                @foreach (RolListViewModel item in ViewBag.Rol)
                {
                    <div class="item" data-value="@item.ID">@item.Descripcion</div>
                }
            </div>
        </div>

        <div class="ui floating dropdown labeled search icon button" id="cbbPartner_type">
            <i class="filter icon"></i>
            <span class="text">Filtrar por socios</span>
            <div class="menu">
                <div class="header">
                    <i class="tags icon"></i> Filter by tag
                </div>
                <div class="item" data-value="0">Todos</div>

                @foreach (PartnersListViewModel item in ViewBag.Partners)
                {
                    <div class="item" data-value="@item.ID">@item.Nombre</div>
                }
            </div>
        </div>

        <div class="ui floating dropdown labeled search icon button" id="cbbSexo">
            <i class="filter icon"></i>
            <span class="text">Filtrar por sexo</span>
            <div class="menu">
                <div class="header">
                    <i class="tags icon"></i> Filter by tag
                </div>
                <div class="item" data-value="0">Todos</div>
                <div class="item" data-value="Femenino">Femenino</div>
                <div class="item" data-value="Masculino">Masculino</div>
            </div>
        </div>

        <input type="text" name="txtEdad" id="txtEdad" />



        <button class="ui positive button" onclick="REPORTS_FUNCTIONS.getReport_user(true)">FILTRAR REPORTE</button>
        <button class="ui positive button" onclick="REPORTS_FUNCTIONS.getReport_user(false)">TRAER TODOS</button>
        <a href="@Url.Action("ReservacionesReportXLS", "Report", new ReportCreationModel{DataSourceIndex= 6, HTMLFile = "ReservacionesReportXLS"} )" class="ui button icon">Excel <i class="file excel icon"></i> </a>

        <div class="ui segment">
            <iframe id="ifrReport" src="" frameborder="0" width="100%" height="680px"></iframe>
        </div>
    </div>
}
catch (Exception)
{
    <script>location.assign("@Url.Action("Error", "Home")");</script>
}
@section Scripts{

    <script>
        $(".ui.dropdown").dropdown();
    </script>

    <script>
        const REPORTS_FUNCTIONS = {
            getReport_user: function (parameter = false) {
                var query = {
                    parameters: {},
                    user_name: Client_User_Name
                };
                if (parameter) {

                    if ($("#cbbRol .item.selected").length > 0 && $("#cbbRol .item.selected").attr("data-value") != 0) {
                        var id_socios = $("#cbbRol .item.selected").attr("data-value");
                        query.parameters.iD_Partner = parseInt(id_socios);
                    }
                    else {

                        delete query.parameters["iD_Partner"];
                    }
                    if ($("#cbbPartner_type .item.selected").length > 0 && $("#cbbPartner_type .item.selected").attr("data-value") != 0) {
                        var id_TipoParners = $("#cbbPartner_type .item.selected").attr("data-value");
                        query.parameters.tipoPartner_Id = parseInt(id_TipoParners);
                    }
                    else {

                        delete query.parameters["tipoPartner_Id"];
                    }
                    if ($("#cbbSexo .item.selected").length > 0 && $("#cbbSexo .item.selected").attr("data-value") != 0) {
                        var id_Sexo = $("#cbbSexo .item.selected").attr("data-value");
                        query.parameters.sexo = id_Sexo;
                    }
                    else {

                        delete query.parameters["sexo"];
                    }
                    if ($("#txtEdad").val() != 0) {
                        const regex = "[0-9-]+$";
                        const edad = $("#txtEdad").val();
                        if (edad.match(regex) != null) {

                            query.parameters.edad = edad;
                        }
                        else {
                            iziToastAlert("formato incorrecto. Seria 21-30", "", "error");
                        }
                    }
                }
                $('#frmUsersReports #ifrReport').attr('src', `https://totaltravelfileservices.yourgreatbusinesscenter.com/PDFs/Users_report_pdf.php?query=${JSON.stringify(query)}`);
            },
        }
        REPORTS_FUNCTIONS.getReport_user(false);
    </script>
}